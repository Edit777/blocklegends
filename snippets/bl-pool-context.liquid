{%- comment -%}
  Canonical pool context resolver for mystery pools.
  Primary: product.metafields.custom.pool_key (trimmed).
{%- endcomment -%}

{%- liquid
  assign bl_pool_key = product.metafields.custom.pool_key.value | default: product.metafields.custom.pool_key | strip | downcase
  assign bl_pool_handle = bl_pool_key

  assign bl_pool_title = ''
  if bl_pool_handle != blank
    assign bl_pool_collection = collections[bl_pool_handle]
    if bl_pool_collection
      assign bl_pool_title = bl_pool_collection.title | strip | escape
    endif
  endif

  if bl_pool_title == blank and bl_pool_handle != blank
    assign bl_pool_title = bl_pool_handle | replace: '-', ' ' | replace: '_', ' ' | capitalize | strip | escape
  endif
-%}

<div
  id="blPoolContext"
  data-bl-pool-handle="{{ bl_pool_handle }}"
  data-bl-pool-key="{{ bl_pool_key }}"
  data-bl-pool-title="{{ bl_pool_title }}"
  hidden
></div>
